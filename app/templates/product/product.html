{% extends 'base.html' %}
{% block css_style %} 

    <link rel="stylesheet" href="{{url_for('static',filename='css/grid.css')}}"> 
    <link rel="stylesheet" href="{{url_for('static',filename='css/table.css')}}"> 
    <link rel="stylesheet" href="{{url_for('static',filename='css/form.css')}}"> 
    <link rel="stylesheet" href="{{url_for('static',filename='css/modal.css')}}"> 

{% endblock %}
{% block nav_inventory %}active{% endblock %}
{% block content %}


    
        <!-- Second Row -->
        <div class="row">
            <div class="">
                <button class="button success" onclick="openModal()">Create</button>
                <div class="modal-container" id="create_product">
                    <div class="modal-content">
                        <span class="close-button" onclick="closeModal()">&times;</span>
                        <div class="form-container full_width">
                            <h3>Create Product</h3>
                    
                            <form method="POST" action="{{ url_for('product.create_product') }}">
                                <!-- Add any necessary form fields and styling as needed -->
                                <label for="barcode">Barcode:</label>
                                <input type="text" inputmode="numeric" pattern="\d*" id="barcode" name="barcode"  autocomplete="false" required>
                                <label for="name">Product Name:</label>
                                <input type="text" id="name" name="name" autocomplete="false" required>
                    
                                <label for="category">Category:</label>
                                <select name="category" id="categories" required>
                                {% if not categories.empty %}
                                    {% for category in categories %}
                                        <option value={{category.Name}}>{{category.Name}}</option>
                                    {% endfor %}
                                {% endif %}
                                </select>
                    
                    
                                <button class="button success" type="submit">Create Product</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="">
                <form action="{{url_for("product.search_product")}}" method="get">

                
                <label for="Search">Search</label>
                <input type="text" id="" name="query" placeholder="Search...">
                <button class="button gray">Search</button>
            </form>
            </div>
        </div>

    



    <div class="table-container ">

        <table class="">
            <thead>
                <tr>
                    <th>Bar Code</th>
                    <th>Name</th>
                    <th>Categories</th>
                    <th>Safety Line </th>
                    <th>Status </th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                    <tr>
                        <form method="POST" action="" style="display: inline-block;">
                            <td>
                                <span><a href="{{url_for('product.get_product',barcode = product.BarCode)}}">{{ product.BarCode }}</a></span>
                                <input type="text" style="display: none;" name="barcode" id="barcode" value="{{ product.BarCode }}" required>
                            </td>
                            <td>
                                <span><a href="{{url_for('product.get_product',barcode = product.BarCode)}}">{{ product.Name }}</a></span>
                                <input type="text" style="display: none;" name="name" id="name" value="{{ product.Name }}" required>
                            </td>
                            <td>
                                {{display_categories(product)}}
                            </td>
                            <td>
                                <span>{{ product.Safety_quantity }}</span>
                                <input type="number" style="display: none;" name="safety_quantity" id="safety_quantity" value="{{ product.Safety_quantity }}" min=0 required>
                            </td>
                            <td>
                                <span>{{ product.Status }}</span>
                            </td>
    
                            <td>
                                <button type="button" class="button info" id="edit" href="javascript:;"><i class='bx bx-edit'></i></button>
                                <button type="submit" class="button success" id="update" onclick="changeFormAction(this)" style="display: none;"><i class='bx bx-check'></i></button>
                                <button type="button" class="button info" id="cancel" href="javascript:;" style="display: none;"><i class='bx bx-x'></i></button>
    
                        </form>
    
                            <form method="POST" action="{{ url_for('product.delete_product', id=product.id) }}" style="display: inline-block;">
        
                                    <button id="delete" class="button error" type="submit" onclick="return confirm('Are you sure you want to delete this item? Product will be deleted along with the inventories! ')"><i class='bx bx-trash-alt'></i></button>
                            </form>
                            </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
{% endblock %}

{% block jscontent %}

<script>
    var btnEdits = document.querySelectorAll('#edit');
    var btnCancels = document.querySelectorAll('#cancel');
    var btnUpdate = document.querySelectorAll('#update');
    var btnDelete = document.querySelectorAll('#delete');

    btnEdits.forEach((btnEdit)=>{
        btnEdit.addEventListener('click',editable);
    });
    
    btnCancels.forEach((btnCancel)=>{
        btnCancel.addEventListener('click',editable)
    });

    function editable(event) {
        var row = event.target.closest('tr');
        var inputElements = row.querySelectorAll('input:not([type=radio])');
        var spanElements = row.querySelectorAll('span');

        inputElements.forEach((inputElement) => {
            inputElement.style.display = (inputElement.style.display === 'none') ? 'inline-block' : 'none';
        });
        spanElements.forEach((spanElement) => {
            spanElement.style.display = (spanElement.style.display === 'none') ? 'inline-block' : 'none';
        });
            // Toggle the display of the edit, update, and cancel links
        row.querySelector('#edit').style.display = (row.querySelector('#edit').style.display === 'none') ? 'inline-block' : 'none';
        row.querySelector('#update').style.display = (row.querySelector('#update').style.display === 'none') ? 'inline-block' : 'none';
        row.querySelector('#cancel').style.display = (row.querySelector('#cancel').style.display === 'none') ? 'inline-block' : 'none';
        row.querySelector('#delete').style.display = (row.querySelector('#delete').style.display === 'none') ? 'inline-block' : 'none';
    }

    function changeFormAction(button){
        var closesttd = button.parentElement;
        var form = closesttd.parentElement;
        if(form){
            var barcodeInput = form.querySelector('#barcode');
            //
            console.log(barcodeInput)
        }else{
            console.log('Form not found')
        }
    }

</script>


<script src="{{url_for('static',filename='/js/modal.js')}}">

  </script>
{% endblock %}




{% macro display_categories(product) %}
        <span>
            {% for category in product.Categories %}
            <a href="{{url_for('product.products_by_category',category_name = category.Name)}}" style="text-decoration: none; color: #dd5b5b">
                {{ category.Name }}
            </a>
            |
            {% endfor %}
        </span>
{% endmacro %}