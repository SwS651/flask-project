{% extends 'base.html' %}
{% block css_style %} 

    <link rel="stylesheet" href="{{url_for('static',filename='css/grid.css')}}"> 
    <link rel="stylesheet" href="{{url_for('static',filename='css/form.css')}}"> 
    <link rel="stylesheet" href="{{url_for('static',filename='css/table.css')}}"> 
{% endblock %}
{% block nav_category %}active{% endblock %}
{% block content %}
    <span class="title"><h1>{% block title %} Categories {% endblock %}</h1></span>

    <div class="grid-container four-two-grid">
        <div class="grid-item">
            <div class="table-container">

                <table>
                <!-- <colgroup>
                    <col span="1" style="width: auto;">
                    <col span="1" style="width: auto ;">
                    <col span="1" style="width: 30%;">
                </colgroup> -->
                <thead>
                    <tr>
                    <th>ID</th>
                    <th>Category</th>
                    <!-- Add other header columns as needed -->
                    <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in categories %}
                    <tr>
                    <form method="POST" action="{{ url_for('category.edit_category',category_name = category.Name) }}" style="display: inline-block;">
                    <td>
                        <span>{{ category.id }}</span>
                    </td>
                    <td>
                        <span>{{ category.Name }}</span>
                        <input type="text" style="display: none;" name="category_name" id="Name" value="{{ category.Name }}" required>
                        
            
                    </td>
            
                    <!-- Add other data columns as needed -->
                    <td>
                        <button class="button gray" type="button" id="edit" href="javascript:;"><i class='bx bx-columns'></i></button>
                        
                        <button class="button info" type="submit" id="update" style="display: none;"><i class='bx bx-check' ></i></button>
                        <button class="button gray" type="button" id="cancel" href="javascript:;" style="display: none;"><i class='bx bx-x'></i></button>
                    </form>
            
                        <form method="POST" action="{{url_for('category.delete_category',id = category.id)}}"
                        style="display: inline-block;">
                        <button class="button error" type="submit" id="delete" onclick="return confirm('Are you sure you want to delete this item?')"><i class='bx bx-trash-alt'></i></button>
                        </form>
                    </td>
                    </tr>
                    {% endfor %}
                </tbody>
                </table>
            
            </div>
        </div>
        <div class="grid-item">
            <div class="form-container">
                <h3>Search</h3>
                
                <form action="{{url_for('category.search_category')}}" method="get">

                    <input type="text" name="query" placeholder="seacrh"autocomplete="false" required>
                    
                    <button class="button success" type="submit">Search</button>
                </form>
            </div>
            <div class="form-container">
                <h3>Category</h3>
                <form action="{{url_for('category.create_category')}}" method="post">
                        <input type="text" name="category_name" id="" placeholder="Food.." autocomplete="false" required>
                        <button class="button success" type="submit">Add</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}


{% block jscontent %}

<script>
    var btnEdits = document.querySelectorAll('#edit');
    var btnCancels = document.querySelectorAll('#cancel');
    var btnUpdate = document.querySelectorAll('#update');
    var btnDelete = document.querySelectorAll('#delete');

    btnEdits.forEach((btnEdit)=>{
        btnEdit.addEventListener('click',editable);
    });
    
    btnCancels.forEach((btnCancel)=>{
        btnCancel.addEventListener('click',editable)
    });

    function editable(event) {
        var row = event.target.closest('tr');
        var inputElements = row.querySelectorAll('input:not([type=radio])');
        var spanElements = row.querySelectorAll('span');

        inputElements.forEach((inputElement) => {
            inputElement.style.display = (inputElement.style.display === 'none') ? 'inline-block' : 'none';
        });
        spanElements.forEach((spanElement) => {
            spanElement.style.display = (spanElement.style.display === 'none') ? 'inline-block' : 'none';
        });
            // Toggle the display of the edit, update, and cancel links
        row.querySelector('#edit').style.display = (row.querySelector('#edit').style.display === 'none') ? 'inline-block' : 'none';
        row.querySelector('#update').style.display = (row.querySelector('#update').style.display === 'none') ? 'inline-block' : 'none';
        row.querySelector('#cancel').style.display = (row.querySelector('#cancel').style.display === 'none') ? 'inline-block' : 'none';
        row.querySelector('#delete').style.display = (row.querySelector('#delete').style.display === 'none') ? 'inline-block' : 'none';
    }

    function changeFormAction(button){
        var closesttd = button.parentElement;
        var form = closesttd.parentElement;
        if(form){
            var barcodeInput = form.querySelector('#barcode');
            //
            console.log(barcodeInput)
        }else{
            console.log('Form not found')
        }
    }

</script>
{% endblock %}